# 匠度測定システム作成プロンプト

## システム概要

60秒間の総合テストを通じて、ユーザーの「匠度」（職人レベル）を測定するWebアプリケーションを作成してください。このシステムは、精密な描画タスク、リアルタイムの顔分析、ストレス反応評価を組み合わせて、手先の器用さ、精神的な落ち着き、ストレス耐性を総合的に評価します。

## 主要機能

### 評価項目（重み付け）
1. **精密さ（Precision）** - 40%: 手作業の正確性
2. **落ち着き（Calmness）** - 30%: 精神的な安定性と感情的な落ち着き
3. **器用さ（Dexterity）** - 30%: 手の安定性と回復能力

### スコアリングシステム
- 総合スコア: 0-100点
- ランク: C（初心者）〜SSS（伝説の職人）
- 運転適性評価も含む

## テストシーケンス（60秒）

1. **0-10秒: 初期キャリブレーション**
   - カメラとマイクの初期化
   - 呼吸パターンのベースライン測定（5回の呼吸サイクル）
   - 表情のベースライン取得

2. **10-25秒: 円描画テスト**
   - ガイドに従って円を描く
   - 精密さ、滑らかさ、手の安定性を測定

3. **25-45秒: ストレステスト**
   - イライラする視覚刺激をランダムに表示
   - BGMのテンポと音量を上げる
   - ストレス下での継続的な描画

4. **45-60秒: 回復評価**
   - ストレス刺激を除去
   - 回復速度を測定
   - 最終計算

## 技術要件

### フロントエンド
- ES6+のクラスベースアーキテクチャを使用した純粋なJavaScript
- HTML5 Canvas（描画インターフェース用）
- WebRTC（カメラアクセス用）
- CSS3（アニメーションとレスポンシブデザイン）

### 必要なライブラリ
- **face-api.js**: 顔認識用
  - TinyFaceDetector: 軽量な顔検出
  - FaceLandmark68Net: 68点の顔ランドマーク
  - FaceExpressionNet: 感情認識

### バックエンド
- Express.jsサーバー（HTTPSホスティング用）
- 自己署名SSL証明書（セキュアなカメラアクセス用）

## モジュール構成

### 1. main.js - メインコントローラー
- すべてのサブシステムを初期化
- 60秒のテストフローを制御
- 測定結果をコンパイルして表示

### 2. camera-controller.js - カメラ管理
- getUserMedia APIでウェブカムアクセス
- ビデオストリーム管理

### 3. face-analyzer.js - 顔分析
- face-api.jsを使用したリアルタイム顔分析
- 呼吸パターンの検出
- 表情からストレス指標を分析
- 7つの基本感情に基づく落ち着きスコア計算

### 4. drawing-analyzer.js - 描画分析
- マウスの動きを追跡し精度を計算
- 円の正確さ、滑らかさ、完成度を測定
- 手の震えと速度の一貫性を検出

### 5. stress-tester.js - ストレステスト管理
- BGMのテンポと音量制御
- イライラする視覚刺激の表示
- ストレス後の回復メトリクス測定

### 6. evaluation-engine.js - 評価エンジン
- 各測定コンポーネントの重み付け
- 総合スコアに基づくランク判定
- 個人化されたアドバイスと運転適性評価の生成

### 7. character-animator.js - ガイドキャラクター
- 視覚的フィードバックと励まし
- テストフェーズとパフォーマンスに基づくアニメーション
- コンテキストに応じたメッセージ表示

## スコアリングアルゴリズム詳細

### 精密さスコア
- **円の正確さ** (50%): 完璧な円からのずれ
- **滑らかさ** (30%): 連続する点間の角度変化
- **完成度** (20%): 円の完成率

### 落ち着きスコア
- **呼吸の安定性** (40%): 呼吸パターンの一貫性
- **表情の落ち着き** (30%): 表情分析（中立/幸せ vs ストレス）
- **ストレス耐性** (30%): ストレスフェーズ中のパフォーマンス

### 器用さスコア
- **速度の一貫性** (35%): 描画速度の変動
- **手の安定性** (35%): 検出された震えの逆数
- **回復速度** (30%): ストレス後のベースラインへの復帰時間

## 必要なアセット

- **BGM**: `sound/backmusic.mp3` - 落ち着いたバックグラウンド音楽
- **キャラクター画像**: `image/c.png` - ガイドの猫キャラクター
- **ストレス画像**: `image/irritating[1-3].png` - 視覚的な妨害画像
- **顔認識モデル**: face-api.jsの事前学習済みモデル

## セットアップと設定

### インストールスクリプト（scripts/install.sh）
1. Node.jsインストールの確認
2. npmの依存関係インストール
3. 自己署名SSL証明書の生成
4. face-api.jsモデルファイルのダウンロード
5. 必要に応じてプレースホルダーアセットの作成

## プライバシーとセキュリティ

- すべての処理はクライアントサイドで実行（サーバーへのデータ送信なし）
- カメラアクセスにはHTTPSが必要
- 個人データの保存や追跡なし

## 実装のポイント

1. **モジュラーアーキテクチャ**: 各機能を独立したクラスとして実装
2. **リアルタイムフィードバック**: 猫キャラクターによる継続的な視覚的・テキストフィードバック
3. **包括的な分析**: 運動スキルと生理的反応を組み合わせたマルチモーダル評価
4. **ストレス耐性テスト**: 音声と視覚的な妨害を含むユニークなストレスフェーズ
5. **個人化されたアドバイス**: 最も弱い領域に基づいたカスタマイズされた推奨事項

このアプリケーションは、コンピュータビジョン、ヒューマンコンピュータインタラクション、ゲーミフィケーションをユニークに融合させ、運転評価、作業療法、精密作業を必要とする職業のスキル評価など、様々な用途に適応できる魅力的な評価ツールを作成します。